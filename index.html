<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Timer</title>
    <link rel="icon" href="img/blue-clock.png">
    <style>
        #timer {
            font-size: 30px;
        }
    </style>
</head>
<body>
    <h1>Timer</h1>
    Hour: <input id="hourInput" type="number" min="0" value="0"><br>
    Minute: <input id="minuteInput" type="number" min="0" max="59" value="0"><br>
    Second: <input id="secondInput" type="number" min="0" max="59" value="0"><br>
    <br>
    <button id="startBtn">Start</button>
    <button id="stopBtn" disabled>Stop</button>
    <button id="resetBtn">Reset</button>
    <br>
    <br>
    <div id="timer">
        <span id="hourText">00</span>
        :
        <span id="minuteText">00</span>
        :
        <span id="secondText">00</span>
    </div>
    <script>
        window.addEventListener('beforeunload', function(e) {
            e.preventDefault();
            e.returnValue = '';
        });

        (function(window, document) {
            var hourInput = document.getElementById('hourInput');
            var minuteInput = document.getElementById('minuteInput');
            var secondInput = document.getElementById('secondInput');

            var startBtn = document.getElementById('startBtn');
            var stopBtn = document.getElementById('stopBtn');
            var resetBtn = document.getElementById('resetBtn');

            var hourText = document.getElementById('hourText');
            var minuteText = document.getElementById('minuteText');
            var secondText = document.getElementById('secondText');

            var durationInSecond = 0;

            var hour = 0;
            var minute = 0;
            var second = 0;

            var _interval;

            var running = false;
            var paused = false;

            var alarm = new Audio('audio/alarm.wav');
            alarm.volume = 0.1;

            function changeBtnState() {
                if (running) {
                    startBtn.disabled = true;
                    stopBtn.disabled = false;
                } else {
                    startBtn.disabled = false;
                    stopBtn.disabled = true;
                }
            }

            function resetTimer() {
                hour = 0;
                minute = 0;
                second = 0;
                running = false;
                paused = false;
                updateTimerText();
                clearInterval(_interval);
                changeBtnState();
            }

            function pauseTimer() {
                running = false;
                paused = true;
                clearInterval(_interval);
                changeBtnState();
            }

            function tick() {
                if (second === 0) {
                    if (minute ===0) {
                        if (hour > 0) {
                            minute = 60;
                            hour--;
                        }
                    }
                    second = 60;
                    minute--;
                }
                second--;
                durationInSecond--;
            }

            function runTimer() {
                _interval = setInterval(function() {
                    console.log(hour, minute, second, durationInSecond);
                    if (durationInSecond <= 0) {
                        console.log('terminated');
                        resetTimer();
                        alarm.play();
                        return;
                    }
                    updateTimerText();
                    tick();
                }, 1000);
            }

            function startTimer() {
                hour = hourInput.value ? parseInt(hourInput.value) : 0;
                minute = minuteInput.value ? parseInt(minuteInput.value) : 0;
                second = secondInput.value ? parseInt(secondInput.value) : 0;
                durationInSecond = (hour * 3600) + (minute * 60) + second;

                if (durationInSecond <= 0) return alert('Duration 0');

                running = true;
                paused = false;
                updateTimerText();
                tick();
                runTimer();
                changeBtnState();
            }

            function resumeTimer() {
                running = true;
                paused = false;
                runTimer();
                changeBtnState();
            }

            function updateTimerText() {
                hourText.innerHTML = hour > 9 ? hour : '0' + hour;
                minuteText.innerHTML = minute > 9 ? minute : '0' + minute;
                secondText.innerHTML = second > 9 ? second : '0' + second;
            }

            startBtn.addEventListener('click', function(e) {
                if (paused) {
                    resumeTimer();
                } else {
                    startTimer();
                }
                changeBtnState();
            });
            stopBtn.addEventListener('click', function(e) {
                pauseTimer();
                changeBtnState();
            });
            resetBtn.addEventListener('click', function(e) {
                running = false;
                resetTimer();
                changeBtnState();
                alarm.pause();
            });

        })(window, document);
    </script>
</body>
</html>